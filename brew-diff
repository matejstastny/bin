#!/usr/bin/env bash

# --------------------------------------------------------------------------------------------
# brew-diff â€” Months Reference
# --------------------------------------------------------------------------------------------
# Author: Matej Stastny
# Date: 2025-09-21 (YYYY-MM-DD)
# License: MIT
# Link: https://github.com/matejstastny/bin
# --------------------------------------------------------------------------------------------
# Usage:
#   ./brew-diff path/to/Brewfile
# Description:
#   Compares installed Homebrew packages and casks against a given Brewfile.
#   Lists missing and extra packages/casks.
# --------------------------------------------------------------------------------------------

if [ -z "$1" ]; then
    echo "Usage: $0 Brewfile"
    exit 1
fi

BREWFILE="$1"

# Installed top-level packages
INSTALLED_FORMULAE=$(brew leaves)
INSTALLED_CASKS=$(brew list --cask)

# From Brewfile
BREWFILE_FORMULAE=$(grep '^brew ' "$BREWFILE" | awk '{print $2}' | tr -d '"')
BREWFILE_CASKS=$(grep '^cask ' "$BREWFILE" | awk '{print $2}' | tr -d '"')

echo "== Missing formulae =="
comm -23 <(echo "$BREWFILE_FORMULAE" | sort) <(echo "$INSTALLED_FORMULAE" | sort)

echo
echo "== Extra formulae =="
comm -13 <(echo "$BREWFILE_FORMULAE" | sort) <(echo "$INSTALLED_FORMULAE" | sort)

echo
echo "== Missing casks =="
comm -23 <(echo "$BREWFILE_CASKS" | sort) <(echo "$INSTALLED_CASKS" | sort)

echo
echo "== Extra casks =="
comm -13 <(echo "$BREWFILE_CASKS" | sort) <(echo "$INSTALLED_CASKS" | sort)
